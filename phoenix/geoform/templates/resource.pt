<div tal:define="name name|field.name;
                 css_class css_class|field.widget.css_class;
                 oid oid|field.oid;
                 mask mask|field.widget.mask;
                 mask_placeholder mask_placeholder|field.widget.mask_placeholder;
                 mime_types mime_types|field.widget.mime_types;
                 upload upload|field.widget.upload;
                 storage_url storage_url|field.widget.storage_url;
                 size_limit size_limit|field.widget.size_limit;
                 style style|field.widget.style;
                 autofocus autofocus|field.autofocus;
                 "
     tal:omit-tag="">

  <!-- input field -->
  <div class="input-group mb-3">
    <input 
      type="text"
      name="${name}" 
      value="${cstruct}" 
      class="form-control"
      placeholder="Enter a URL pointing to your resource" 
      aria-label="dont know" 
      aria-describedby="button-${oid}"
      id="${oid}"/>
    <button 
      class="btn btn-outline-secondary" 
      type="button" 
      data-bs-toggle="modal" 
      data-bs-target="#upload-form-${oid}"
      id="button-${oid}">Upload
    </button>
  </div>

  <!-- Modal -->
  <div id="upload-form-${oid}" 
    class="modal fade" 
    data-bs-backdrop="static" 
    data-bs-keyboard="false" 
    tabindex="-1"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">Upload File</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div 
            action="/upload"
            class="dropzone"
            id="my-dropzone">
            <div class="fallback">
              <input type="file" name="file">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Upload</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  // https://github.com/dropzone/dropzone/blob/main/src/options.js
  Dropzone.options.myDropzone = { // camelized version of the `id`
    paramName: "file", // The name that will be used to transfer the file
    //uploadMultiple: false,
    //chunking: true,
    //forceChunking: true,
    //chunkSize: 1024 * 1024, // bytes
    //parallelChunkUploads: false,
    //retryChunks: true,
    //retryChunksLimit: 3,
    defaultHeaders: false,
    //binaryBody: true,
    maxFilesize: 20, // MB
    //maxFiles: 1,
    acceptedFiles: ".txt,.nc,.zip",
    init: function() {
      this.on("success", function(file, response) {
        console.log("A file has been uploaded");
      });
    },
  };
  console.log("hello dropzone");
</script>

</div>
